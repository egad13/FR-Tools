<!doctype html>

<html lang="en">
<head>
	<!-- Script Setup -->
	<script type="text/javascript" src="../js/common_setup.js"></script>
	<script type="text/javascript" src="../js/import_map.js" preloads="data forms convert"></script>

	<!-- Meta Tags -->
	<title>Hatchling Probability Calculator - Kay's FR Tools</title>
	<meta charset="utf-8">
	<meta name="description" content="Hatchling Probability Calculator">
	<meta name="author" content="egad13">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- Modules -->
	<!-- Using the src attribute on a script type=module appears to be broken in Firefox v121; or at least, it isn't working for this site. Switching to a dynamic import in an inline module and seeing if that fixes it. -->
	<!--<script type="module" src="../js/apps/hatchcalc/main.js"></script>-->
	<script type="module">
		import("../js/apps/hatchcalc/main.js");
	</script>

	<!-- Styles -->
	<link rel="stylesheet" href="../css/styles.css" />
	<link rel="stylesheet" href="../css/hatchcalc.css" />
</head>

<body>

<main id="main">

	<form>
		<h2>Input</h2>

		<fieldset id="p1">
			<legend>Parent 1</legend>

			<label for="p1-b">Breed:</label>
			<select id="p1-b" is="fr-breeds"></select>

			<span>Primary:</span>
			<label for="p1-c1" class="sr-only">Primary Colour</label>
			<select id="p1-c1" is="fr-colours" class="primary"></select>
			<label for="p1-g1" class="sr-only">Primary Gene</label>
			<select id="p1-g1" is="fr-genes" slot="primary" breed="p1-b"></select>

			<span>Secondary:</span>
			<label for="p1-c2" class="sr-only">Secondary Colour</label>
			<select id="p1-c2" is="fr-colours" class="secondary"></select>
			<label for="p1-g2" class="sr-only">Secondary Gene</label>
			<select id="p1-g2" is="fr-genes" slot="secondary" breed="p1-b"></select>

			<span>Tertiary:</span>
			<label for="p1-c3" class="sr-only">Tertiary Colour</label>
			<select id="p1-c3" is="fr-colours" class="tertiary"></select>
			<label for="p1-g3" class="sr-only">Tertiary Gene</label>
			<select id="p1-g3" is="fr-genes" slot="tertiary" breed="p1-b"></select>
		</fieldset>

		<fieldset id="p2">
			<legend>Parent 2</legend>

			<label for="p2-b">Breed:</label>
			<select id="p2-b" is="fr-breeds"></select>

			<span>Primary:</span>
			<label for="p2-c1" class="sr-only">Primary Colour</label>
			<select id="p2-c1" is="fr-colours" class="primary"></select>
			<label for="p2-g1" class="sr-only">Primary Gene</label>
			<select id="p2-g1" is="fr-genes" slot="primary" breed="p2-b"></select>

			<span>Secondary:</span>
			<label for="p2-c2" class="sr-only">Secondary Colour</label>
			<select id="p2-c2" is="fr-colours" class="secondary"></select>
			<label for="p2-g2" class="sr-only">Secondary Gene</label>
			<select id="p2-g2" is="fr-genes" slot="secondary" breed="p2-b"></select>

			<span>Tertiary:</span>
			<label for="p2-c3" class="sr-only">Tertiary Colour</label>
			<select id="p2-c3" is="fr-colours" class="tertiary"></select>
			<label for="p2-g3" class="sr-only">Tertiary Gene</label>
			<select id="p2-g3" is="fr-genes" slot="tertiary" breed="p2-b"></select>
		</fieldset>

		<fieldset id="h">
			<legend>Hatchling</legend>

			<label for="h-b">Breed:</label>
			<select id="h-b" is="fr-breeds">
				<option value="any" selected="selected">Any</option>
			</select>

			<label for="h-e">Eye Type:</label>
			<select id="h-e" is="fr-eyes" only-natural>
				<option value="any" selected="selected">Any</option>
			</select>

			<label for="h-gen">Gender:</label>
			<select id="h-gen" is="fr-genders">
				<option value="any" selected="selected">Any</option>
			</select>

			<div class="check-wrapper">
				<label for="use-ranges">
					<input type="checkbox" id="use-ranges" name="use-ranges" />
					Use colour ranges
				</label>
			</div>

			<span class="pri-span">Primary:</span>
			<div class="range-wrapper">
				<label for="h-c1" class="sr-only">Primary Colour</label>
				<select id="h-c1" is="fr-colours" class="primary">
					<option value="any">Any</option>
				</select>

				<span class="colour-range">to</span>

				<label for="h-c1r" class="sr-only colour-range">Primary Colour 2</label>
				<select id="h-c1r" is="fr-colours" class="primary colour-range" disabled>
					<option value="">---</option>
				</select>
			</div>
			<label for="h-g1" class="sr-only">Primary Gene</label>
			<select id="h-g1" is="fr-genes" slot="primary" breed="h-b" default="Any">
				<option value="any">Any</option>
			</select>

			<span class="sec-span">Secondary:</span>
			<div class="range-wrapper">
				<label for="h-c2" class="sr-only">Secondary Colour</label>
				<select id="h-c2" is="fr-colours" class="secondary">
					<option value="any">Any</option>
				</select>

				<span class="colour-range">to</span>

				<label for="h-c2r" class="sr-only colour-range">Secondary Colour 2</label>
				<select id="h-c2r" is="fr-colours" class="secondary colour-range" disabled>
					<option value="">---</option>
				</select>
			</div>
			<label for="h-g2" class="sr-only">Secondary Gene</label>
			<select id="h-g2" is="fr-genes" slot="secondary" breed="h-b" default="Any">
				<option value="any">Any</option>
			</select>

			<span class="ter-span">Tertiary:</span>
			<div class="range-wrapper">
				<label for="h-c3" class="sr-only">Tertiary Colour</label>
				<select id="h-c3" is="fr-colours" class="tertiary">
					<option value="any">Any</option>
				</select>

				<span class="colour-range">to</span>

				<label for="h-c3r" class="sr-only colour-range">Tertiary Colour 2</label>
				<select id="h-c3r" is="fr-colours" class="tertiary colour-range" disabled>
					<option value="">---</option>
				</select>
			</div>
			<label for="h-g3" class="sr-only">Tertiary Gene</label>
			<select id="h-g3" is="fr-genes" slot="tertiary" breed="h-b" default="Any">
				<option value="any">Any</option>
			</select>

		</fieldset>

		<template id="import-controls">
			<details>
				<summary>Import from scrying workshop link</summary>
				<input id="a-scry" type="url" placeholder="https://www1.flightrising.com/scrying/predict?breed=7&..."/>
				<button type="button" class="scry-btn">Import</button>
				<label for="a-scry">Enter a scrying workshop URL - not a saved morphology, a link to the exact traits.</label>
			</details>
			<details>
				<summary>Import from dragon profile</summary>
				<textarea id="a-profile"></textarea>
				<button type="button" class="profile-btn">Import</button>
				<label for="a-profile">Enter the contents of a dragon's profile - select all the text on the profile, copy it, and paste it here.</label>
			</details>
		</template>
		<script>
			// Add import controls to all fieldsets
			(function() {
				const template = document.querySelector("#import-controls");

				for (const d of ["p1", "p2", "h"]) {
					const importControls = template.content.cloneNode(true);
					for (const details of importControls.childNodes) {
						for (const elt of details.childNodes) {
							if (elt.id) {
								elt.id = elt.id?.replace("a", d);
							}
							if (elt.htmlFor) {
								elt.htmlFor = elt.htmlFor?.replace("a", d);
							}
						}
					}
					document.querySelector(`fieldset#${d}`).append(importControls);
				}
			})();
		</script>

		<button type="button" id="calc">Calculate Probability</button>
	</form>

	<section >
		<h2>Results</h2>

		<output id="results">
			<div id="placeholder">
				<p>Enter the info for the parents and the desired hatchling, then click Calculate!</p>
			</div>
		</output>
	</section>

</main>


</body>
</html>
